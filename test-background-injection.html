<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Background Script Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(45deg, #ff9a56, #ffad56);
            min-height: 100vh;
        }
        
        .test-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        #test-button {
            padding: 15px 30px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin: 20px 0;
        }
        
        #test-button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="test-content">
        <h1>ðŸ”§ Background Script Injection Test</h1>
        <p>This tests the background.js injection method like the Chrome extension would use.</p>
        <p>Click the button below to simulate the extension being triggered.</p>
        
        <button id="test-button">Simulate Extension Click</button>
        
        <div style="margin-top: 30px;">
            <h3>Sample Page Content</h3>
            <p>This represents a web page where the extension would be activated.</p>
            <p>The extension creates an overlay with a blurry background effect that should not interfere with this content.</p>
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5TYW1wbGUgSW1hZ2U8L3RleHQ+PC9zdmc+" alt="Sample image" style="max-width: 100%; height: auto; margin: 20px 0;">
        </div>
    </div>

    <script>
        document.getElementById('test-button').addEventListener('click', function() {
            console.log('Simulating background script injection...');
            
            // Simulate the exact same injection as background.js
            simulateBackgroundScriptInjection();
        });
        
        function simulateBackgroundScriptInjection() {
            // This simulates the content that background.js injects
            const injectApp = () => {
                const existingContainer = document.getElementById("subtitle-extension-root");
                if (existingContainer) {
                    existingContainer.style.display = existingContainer.style.display === "none" ? "block" : "none";
                    return;
                }

                const overlay = document.createElement("div");
                overlay.id = "subtitle-extension-overlay";
                overlay.style.cssText = \`
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background-color: rgba(20, 20, 20, 0.8);
                    backdrop-filter: blur(12px);
                    -webkit-backdrop-filter: blur(12px);
                    z-index: 2147483647;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-family: "Inter", sans-serif;
                \`;

                const contentContainer = document.createElement("div");
                contentContainer.id = "subtitle-extension-content";
                contentContainer.style.cssText = \`
                    background: white;
                    border-radius: 12px;
                    padding: 40px;
                    max-width: 90vw;
                    max-height: 90vh;
                    overflow: auto;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                    position: relative;
                \`;

                const closeButton = document.createElement("button");
                closeButton.innerHTML = "Ã—";
                closeButton.style.cssText = \`
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    font-size: 30px;
                    cursor: pointer;
                    color: #666;
                    line-height: 1;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                \`;

                closeButton.addEventListener("click", function() {
                    overlay.remove();
                });

                const reactRoot = document.createElement("div");
                reactRoot.id = "subtitle-extension-root";
                reactRoot.style.cssText = \`
                    min-height: 400px;
                    min-width: 600px;
                \`;

                contentContainer.appendChild(closeButton);
                contentContainer.appendChild(reactRoot);
                overlay.appendChild(contentContainer);

                document.body.appendChild(overlay);

                // Load React and App components
                loadReactAndApp(reactRoot);

                document.addEventListener("keydown", function(e) {
                    if (e.key === "Escape" && document.getElementById("subtitle-extension-overlay")) {
                        overlay.remove();
                    }
                });
            };

            injectApp();
        }
        
        function loadReactAndApp(reactRoot) {
            // Simulate loading React first
            if (!window.React || !window.ReactDOM) {
                const reactScript = document.createElement('script');
                reactScript.src = '/dist/js/react.production.min.js';
                reactScript.onload = function() {
                    const reactDOMScript = document.createElement('script');
                    reactDOMScript.src = '/dist/js/react-dom.production.min.js';
                    reactDOMScript.onload = function() {
                        loadApp(reactRoot);
                    };
                    document.head.appendChild(reactDOMScript);
                };
                document.head.appendChild(reactScript);
            } else {
                loadApp(reactRoot);
            }
        }
        
        function loadApp(reactRoot) {
            // Load the App component
            const appScript = document.createElement('script');
            appScript.src = '/dist/App.js';
            appScript.onload = function() {
                if (window.React && window.ReactDOM && window.App) {
                    const root = window.ReactDOM.createRoot(reactRoot);
                    root.render(window.React.createElement(window.App));
                } else {
                    console.error("React or App not loaded properly");
                    reactRoot.innerHTML = \`
                        <div style="text-align: center; padding: 40px;">
                            <h2>Subtitle Extension</h2>
                            <p>Extension loaded but React components unavailable.</p>
                            <p>This fallback proves the overlay and blur effect work correctly.</p>
                        </div>
                    \`;
                }
            };
            appScript.onerror = function() {
                reactRoot.innerHTML = \`
                    <div style="text-align: center; padding: 40px;">
                        <h2>Subtitle Extension</h2>
                        <p>Extension loaded successfully!</p>
                        <p>Fallback mode - UI overlay working with blurry background.</p>
                    </div>
                \`;
            };
            document.head.appendChild(appScript);
        }
    </script>
</body>
</html>